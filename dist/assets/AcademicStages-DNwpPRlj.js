import{r as u,i as M,b as B,a as L,j as e,I as O,k as F,l as $,B as E,S as h,m as U,n as D,T as H,d as I,e as T,f as w,g as R,P,M as C,o as q,C as G}from"./index-De2xroJ3.js";function Q({tempCat:t,onCloseUp:i}){const[l,d]=u.useState((t==null?void 0:t.educational_system)??null),o=t==null?void 0:t.name,S=(o==null?void 0:o.split(" - ")[0])??"",[p,{isLoading:f}]=M(),{data:m,isLoading:j}=B({search:"",page:1}),x=((m==null?void 0:m.data)??[]).map(a=>{var r;return{value:((r=a.id)==null?void 0:r.toString())||"",label:a.name,data:a}})||[],{register:N,handleSubmit:b,setValue:g,control:c,formState:{errors:s}}=L();u.useEffect(()=>{var a;t&&(g("name",S),g("educational_system_id",((a=t.educational_system)==null?void 0:a.id)??null))},[t,g,S]);const y=async a=>{var n,A;const r=new FormData;r.append("name",`${a.name} - ${l==null?void 0:l.name}`),r.append("educational_system_id",String(a.educational_system_id));try{await p({id:Number(t==null?void 0:t.id),body:{name:`${a.name} - ${l==null?void 0:l.name}`,educational_system_id:a.educational_system_id}}).unwrap(),h.fire("Success","تم التعديل بنجاح","success"),i()}catch(k){console.log(k);const v=k;h.fire("Error",(A=(n=v==null?void 0:v.data)==null?void 0:n.errors)!=null&&A.name?v.data.errors.name.join(`
`):"Something went wrong","error")}i()};return e.jsxs("form",{className:"flex justify-center  flex-col my-12 gap-2 p-5 w-full ",onSubmit:b(y),children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"اسم المرحلة الدراسية"}),e.jsx(O,{type:"text",...N("name",{required:"حقل الاسم مطلوب"})}),s.name&&e.jsx("p",{className:"text-red-500 text-sm",children:s.name.message})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("label",{className:"block mb-1",children:"اسم النظام التعليمى"}),e.jsx(F,{control:c,name:"educational_system_id",render:({field:a})=>e.jsx($,{...a,options:x,isClearable:!0,className:"w-auto",isLoading:j,placeholder:"اسم النظام التعليمى",onChange:r=>{a.onChange((r==null?void 0:r.value)??null),d((r==null?void 0:r.data)??null)},value:x.find(r=>r.value==a.value)??null})})]}),e.jsx("div",{children:e.jsx(E,{className:"w-full text-3xl",disabled:f,children:f?"انتظر...":"تحديث المرحلة"})})]})}function V(){var r;const[t,i]=u.useState(1),[l,d]=u.useState(""),{data:o,error:S,isLoading:p}=U({page:t,search:l}),[f,m]=u.useState(!1),[j,_]=u.useState(),x=()=>m(!1),N=()=>m(!0),b=(o==null?void 0:o.data)??[],g=((r=o==null?void 0:o.meta)==null?void 0:r.total)??0,[c]=D(),s=async n=>{if((await h.fire({title:"هل أنت متأكد؟",text:"لن تتمكن من التراجع عن هذا!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"نعم، احذف",cancelButtonText:"إلغاء",reverseButtons:!0})).isConfirmed)try{await c(n).unwrap(),h.fire("تم الحذف!","تم الحذف بنجاح.","success")}catch(k){h.fire("Error",`Something went wrong! ${k} `,"error")}},y=u.useRef(null),a=n=>{d(n.target.value)};return p?e.jsx("p",{children:"جاري تحميل البيانات..."}):S?e.jsx("p",{className:"text-red-500",children:"حدث خطأ أثناء جلب البيانات!"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx("div",{className:"w-full my-5 px-4",children:e.jsx("input",{value:l,onChange:a,ref:y,type:"text",placeholder:"ابحث عن مرحلة دراسية ...",className:"h-11 w-full text-center rounded-lg border border-gray-300 bg-transparent py-2.5 px-4 text-sm text-gray-800 shadow-sm placeholder:text-gray-400 focus:border-blue-400 focus:ring-2 focus:ring-blue-200 dark:border-gray-600 dark:bg-gray-900 dark:text-white dark:placeholder:text-gray-400"})}),e.jsxs("div",{className:"max-w-full overflow-x-auto",children:[e.jsxs(H,{children:[e.jsx(I,{children:e.jsxs(T,{className:"bg-gray-50 dark:bg-gray-800",children:[e.jsx(w,{isHeader:!0,className:"px-5 py-3 font-semibold text-purple-700 text-start",children:"اسم المرحلة الدراسية"}),e.jsx(w,{isHeader:!0,className:"px-5 py-3 font-semibold text-purple-700 text-start",children:"اسم النظام التعليمى"}),e.jsx(w,{isHeader:!0,className:"px-5 py-3 font-semibold text-purple-700 text-center text-sm dark:text-gray-300",children:"الإجراءات"})]})}),e.jsx(R,{className:"divide-y divide-gray-100 dark:divide-gray-700",children:b.map(n=>e.jsxs(T,{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx(w,{className:"px-5 py-3 font-medium text-gray-900 text-start dark:text-white",children:n.name}),e.jsx(w,{className:"px-5 py-3 text-gray-600 text-start dark:text-gray-300",children:n.educational_system.name}),e.jsx(w,{className:"px-5 py-3 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(E,{className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg",onClick:()=>{N(),_(n)},children:"تعديل"}),e.jsx(E,{className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg",onClick:()=>s(n==null?void 0:n.id),children:"حذف"})]})})]},n.id))})]}),e.jsx("div",{className:"p-4",children:e.jsx(P,{page:t,SetPage:i,total:g})})]})]}),e.jsxs(C,{className:"w-full lg:w-4/12 xl:w-4/12 h-auto relative rounded-3xl bg-white dark:bg-gray-900",isOpen:f,onClose:x,children:[e.jsx("h1",{className:"flex justify-center p-3 text-2xl font-semibold text-gray-800 dark:text-white",children:"تعديل مرحلة دراسية"}),e.jsx(Q,{onCloseUp:x,tempCat:j})]})]})}function z({onClose:t}){const[i,l]=u.useState(null),{data:d,isLoading:o}=B({search:"",page:1}),p=((d==null?void 0:d.data)??[]).map(c=>{var s;return{value:((s=c.id)==null?void 0:s.toString())||"",label:c.name,data:c}})||[],[f,{data:m,isLoading:j}]=q(),{register:_,handleSubmit:x,control:N,formState:{errors:b}}=L(),g=async c=>{var y,a;const s=new FormData;s.append("name",`${c.name} - ${i==null?void 0:i.name}`),s.append("educational_system_id",String(c.educational_system_id));try{await f(s).unwrap(),h.fire("تم ","تم بنجاح","success")}catch(r){const n=r;h.fire("Error",(a=(y=n==null?void 0:n.data)==null?void 0:y.errors)!=null&&a.name?n.data.errors.name.join(`
`):"Something went wrong","error")}t()};return e.jsxs("form",{className:"flex justify-center  flex-col my-12 gap-2 p-5 w-full ",onSubmit:x(g),children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"اسم المرحلة الدراسية"}),e.jsx(O,{type:"text",..._("name",{required:"حقل الاسم مطلوب"})}),b.name&&e.jsx("p",{className:"text-red-500 text-sm",children:b.name.message})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("label",{className:"block mb-1",children:"اسم النظام التعليمى"}),e.jsx(F,{control:N,name:"educational_system_id",render:({field:c})=>e.jsx($,{...c,options:p,isClearable:!0,className:"w-auto",isLoading:o,placeholder:"اسم النظام التعليمى",onChange:s=>{c.onChange((s==null?void 0:s.value)??null),l((s==null?void 0:s.data)??null)},value:p.find(s=>s.value===c.value)})})]}),e.jsx("div",{children:e.jsx(E,{className:"w-full text-3xl",disabled:j,children:j?"انتظر...":" اضافة مرحلة دراسية"})}),m&&e.jsx("p",{style:{color:"green"},children:"store added successfully!"})]})}const K=()=>{const[t,i]=u.useState(!1),l=()=>{i(!1)},d=()=>{i(!0)};return e.jsxs(G,{onOpen:d,title:"academic-stages",children:[e.jsx(V,{}),e.jsxs(C,{className:"w-full  lg:w-4/12 xl:w-4/12  h-auto relative  rounded-3xl bg-white  dark:bg-gray-900",isOpen:t,onClose:l,children:[e.jsx("h1",{className:"flex justify-center p-3  text-3xl",children:"المراحل الدراسية"}),e.jsx(z,{onClose:l})]})]})};export{K as default};
