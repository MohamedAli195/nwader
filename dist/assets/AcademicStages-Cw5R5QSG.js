import{r as u,p as M,m as B,a as L,j as e,I as O,k as F,l as $,B as v,S as h,q as U,s as E,T as D,d as H,e as T,f as w,g as I,P as R,M as C,t as q,C as P}from"./index-De2xroJ3.js";function G({tempCat:r,onCloseUp:i}){const[c,o]=u.useState((r==null?void 0:r.academic_stage)??null),d=r==null?void 0:r.name,S=(d==null?void 0:d.split(" - ")[0])??"",[p,{isLoading:b}]=M(),{data:m,isLoading:f}=B({search:"",page:1}),x=((m==null?void 0:m.data)??[]).map(s=>({value:s.id??0,label:s.name,data:s}))||[],{register:N,handleSubmit:j,setValue:g,control:l,formState:{errors:a}}=L();u.useEffect(()=>{var s;r&&(g("name",S),g("academic_stage_id",((s=r.academic_stage)==null?void 0:s.id)??null))},[r,g,S]);const y=async s=>{var t,Y;const n=new FormData;n.append("name",`${s.name} - ${c==null?void 0:c.name} `),n.append("academic_stage_id",String(s.academic_stage_id));try{await p({id:Number(r==null?void 0:r.id),body:{name:`${s.name} - ${c==null?void 0:c.name}`,academic_stage_id:s.academic_stage_id}}).unwrap(),h.fire("Success","Update Academic Year Successfully!","success"),i()}catch(_){console.log(_);const A=_;h.fire("Error",(Y=(t=A==null?void 0:A.data)==null?void 0:t.errors)!=null&&Y.name?A.data.errors.name.join(`
`):"Something went wrong","error")}i()};return e.jsxs("form",{className:"flex justify-center  flex-col my-12 gap-2 p-5 w-full ",onSubmit:j(y),children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"اسم الصف الدراسي"}),e.jsx(O,{type:"text",...N("name",{required:"حقل الاسم مطلوب"})}),a.name&&e.jsx("p",{className:"text-red-500 text-sm",children:a.name.message})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("label",{className:"block mb-1",children:"اسم المرحلة التعليمية "}),e.jsx(F,{control:l,name:"academic_stage_id",render:({field:s})=>e.jsx($,{...s,options:x,isClearable:!0,className:"w-auto",isLoading:f,placeholder:"اسم المرحلة التعليمية",onChange:n=>{s.onChange((n==null?void 0:n.value)??null),o((n==null?void 0:n.data)??null)},value:x.find(n=>n.value==s.value)??null})})]}),e.jsx("div",{children:e.jsx(v,{className:"w-full text-3xl",disabled:b,children:b?"انتظر...":" تعديل الصف التعليمي"})})]})}function Q(){var n;const[r,i]=u.useState(1),[c,o]=u.useState(""),{data:d,error:S,isLoading:p}=U({page:r,search:c}),[b,m]=u.useState(!1),[f,k]=u.useState(),x=()=>m(!1),N=()=>m(!0),j=(d==null?void 0:d.data)??[],g=((n=d==null?void 0:d.meta)==null?void 0:n.total)??0,[l]=E(),a=async t=>{if((await h.fire({title:"هل أنت متأكد؟",text:"لن تتمكن من التراجع عن هذا!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#2563eb",cancelButtonColor:"#dc2626",confirmButtonText:"نعم، احذف",cancelButtonText:"إلغاء",buttonsStyling:!0,reverseButtons:!0})).isConfirmed)try{await l(t).unwrap(),h.fire("تم الحذف!","تم الحذف بنجاح.","success")}catch(_){h.fire("خطأ",`حدث خطأ ما! ${_}`,"error")}},y=u.useRef(null),s=t=>o(t.target.value);return p?e.jsx("p",{children:"جاري تحميل البيانات..."}):S?e.jsx("p",{className:"text-red-500",children:"حدث خطأ أثناء جلب البيانات!"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"overflow-hidden rounded-xl border border-gray-200 bg-white shadow-md dark:border-gray-700 dark:bg-gray-900",children:[e.jsx("div",{className:"w-full p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:e.jsx("input",{value:c,onChange:s,ref:y,type:"text",placeholder:"ابحث هنا...",className:"h-11 w-full rounded-lg border border-gray-300 bg-white px-4 text-sm text-gray-800 shadow-sm placeholder:text-gray-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-400"})}),e.jsx("div",{className:"max-w-full overflow-x-auto",children:e.jsxs(D,{children:[e.jsx(H,{children:e.jsxs(T,{className:"bg-gray-50 dark:bg-gray-800",children:[e.jsx(w,{isHeader:!0,className:"px-5 py-3 font-semibold text-purple-700 text-start",children:"اسم الصف الدراسي"}),e.jsx(w,{isHeader:!0,className:"px-5 py-3 font-semibold text-purple-700 text-start",children:"المرحلة التعليمية"}),e.jsx(w,{isHeader:!0,className:"px-5 py-3 font-semibold text-purple-700 text-center text-sm dark:text-gray-300",children:"الإجراءات"})]})}),e.jsx(I,{className:"divide-y divide-gray-100 dark:divide-gray-700",children:j.map(t=>e.jsxs(T,{className:"hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:[e.jsx(w,{className:"px-5 py-4 text-start text-gray-900 dark:text-gray-100 font-medium",children:t.name}),e.jsx(w,{className:"px-5 py-4 text-gray-600 dark:text-gray-400 text-start",children:t.academic_stage.name}),e.jsxs(w,{className:"px-5 py-4 text-center space-x-2",children:[e.jsx(v,{className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg",onClick:()=>{N(),k(t)},children:"تعديل"}),e.jsx(v,{className:"bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg mx-1",onClick:()=>a(t==null?void 0:t.id),children:"حذف"})]})]},t.id))})]})}),e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:e.jsx(R,{page:r,SetPage:i,total:g})})]}),e.jsxs(C,{className:"w-full lg:w-4/12 xl:w-4/12 h-auto relative rounded-2xl bg-white dark:bg-gray-900",isOpen:b,onClose:x,children:[e.jsx("h1",{className:"flex justify-center p-3 text-2xl font-semibold text-gray-700 dark:text-gray-200",children:"تعديل الصف الدراسي"}),e.jsx(G,{onCloseUp:x,tempCat:f})]})]})}function V({onClose:r}){const[i,c]=u.useState(null),{data:o,isLoading:d}=B({search:"",page:1}),p=((o==null?void 0:o.data)??[]).map(l=>{var a;return{value:((a=l.id)==null?void 0:a.toString())||"",label:l.name,data:l}})||[],[b,{data:m,isLoading:f}]=q(),{register:k,handleSubmit:x,control:N,formState:{errors:j}}=L(),g=async l=>{var y,s;const a=new FormData;a.append("name",`${l.name} - ${i==null?void 0:i.name} `),a.append("academic_stage_id",String(l.academic_stage_id));try{await b(a).unwrap(),h.fire("تم ","تم بنجاح","success")}catch(n){const t=n;h.fire("Error",(s=(y=t==null?void 0:t.data)==null?void 0:y.errors)!=null&&s.name?t.data.errors.name.join(`
`):"Something went wrong","error")}r()};return e.jsxs("form",{className:"flex justify-center  flex-col my-12 gap-2 p-5 w-full ",onSubmit:x(g),children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"اسم الصف الدراسى"}),e.jsx(O,{type:"text",...k("name",{required:"حقل الاسم مطلوب"})}),j.name&&e.jsx("p",{className:"text-red-500 text-sm",children:j.name.message})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("label",{className:"block mb-1",children:"اسم المرحلة التعليمية"}),e.jsx(F,{control:N,name:"academic_stage_id",render:({field:l})=>e.jsx($,{...l,options:p,isClearable:!0,className:"w-auto",isLoading:d,placeholder:"اسم الصف التعليمى",onChange:a=>{l.onChange((a==null?void 0:a.value)??null),c((a==null?void 0:a.data)??null)},value:p.find(a=>a.value===l.value)})})]}),e.jsx("div",{children:e.jsx(v,{className:"w-full text-3xl",disabled:f,children:f?"انتظر...":" اضافة الصف دراسي"})}),m&&e.jsx("p",{style:{color:"green"},children:"Academic-Year added successfully!"})]})}const J=()=>{const[r,i]=u.useState(!1),c=()=>{i(!1)},o=()=>{i(!0)};return e.jsxs(P,{onOpen:o,title:"academic-year",children:[e.jsx(Q,{}),e.jsxs(C,{className:"w-full  lg:w-4/12 xl:w-4/12  h-auto relative  rounded-3xl bg-white  dark:bg-gray-900",isOpen:r,onClose:c,children:[e.jsx("h1",{className:"flex justify-center p-3  text-3xl",children:"المراحل الدراسية"}),e.jsx(V,{onClose:c})]})]})};export{J as default};
